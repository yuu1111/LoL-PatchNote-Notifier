# League of Legends パッチノート Discord 通知システム 開発・デプロイガイド

## 5. 開発とデプロイの考慮事項

### 5.1. 開発フロー

1.  **リポジトリのクローン:**
    ```bash
    git clone your-repo-url
    cd lol_patch_notifier_ts
    ```
2.  **依存関係のインストール:**
    ```bash
    pnpm install # または yarn install / npm install
    ```
3.  **環境設定:** `.env.example` を参考に、`.env` ファイルを作成し、`DISCORD_WEBHOOK_URL` などを設定します。
    ```
    # .env
    DISCORD_WEBHOOK_URL="YOUR_DISCORD_WEBHOOK_URL"
    # LOL_PATCH_NOTES_URL="https://www.leagueoflegends.com/ja-jp/news/game-updates/" # デフォルト値を使用
    # LAST_STATUS_FILE_PATH="./last_patch_status.json" # デフォルト値を使用
    # CHECK_INTERVAL_CRON="0 */1 * * *" # 1時間ごと
    # LOG_LEVEL="info"
    ```
4.  **開発モードで実行:**
    ```bash
    pnpm dev # `ts-node-dev` などを使って自動リロードしながら実行するスクリプトを package.json に追加
    ```
    `package.json` に以下のようなスクリプトを追加します。
    ```json
    {
      "scripts": {
        "dev": "ts-node-dev --respawn --transpile-only src/app.ts",
        "build": "tsc",
        "start": "node dist/app.js",
        "lint": "eslint src --ext .ts",
        "format": "prettier --write \"src/**/*.ts\"",
        "test": "jest"
      }
    }
    ```
5.  **コード品質チェック:**
    ```bash
    pnpm lint
    pnpm format
    ```
6.  **テスト実行:**
    ```bash
    pnpm test
    ```

### 5.2. ビルドと本番実行

1.  **ビルド:**
    ```bash
    pnpm build
    ```
    これにより、`dist` ディレクトリにコンパイル済みの JavaScript ファイルが出力されます。
2.  **本番実行:**
    ```bash
    node dist/app.js
    ```

### 5.3. デプロイに関する考慮事項

  * **環境変数:** デプロイ環境 (Lambda, Docker, PaaS) に応じて、`DISCORD_WEBHOOK_URL` などの環境変数を適切に設定します。
  * **状態の永続化:**
      * **サーバーレス環境:** `last_patch_status.json` を S3 (AWS Lambda) や Cloud Storage (Google Cloud Functions) などのオブジェクトストレージ、または Redis / DynamoDB などのキーバリューストアに保存するように `fileStorage.ts` を改修する必要があります。ファイルシステムは一時的なストレージであり、次回実行時に保持される保証がないためです。
      * **コンテナ/PaaS:** ボリュームマウントを使用して `last_patch_status.json` を永続化するか、同様に外部の永続化ストアを利用します。
  * **定期実行:**
      * **サーバーレス環境:** AWS EventBridge (CloudWatch Events) や Google Cloud Scheduler を使用して、関数を定期的にトリガーします。`node-cron` は不要になります。
      * **コンテナ/PaaS:** デプロイサービスの組み込みスケジューリング機能を利用するか、`node-cron` を使用し続けます（ただし、単一インスタンスでの実行を保証する設定が必要）。
  * **ログの集中管理:** CloudWatch Logs, Google Cloud Logging, Datadog など、デプロイ環境に応じたログ管理サービスにログを出力するようにロガーを設定します。